<!DOCTYPE html>
<html>
    <head>
        <title>PROFILI KLIENT</title>
        <link rel="stylesheet" href="../css/content.css">
    </head>
    <body>
        <div class="content">
            <span class="titull_fqKlientit">COFFEE DEA & RESTAURANT</span>
           
            <div class="mbeshtjelles">
                <h2 class="newAccount_titull">PAGESA:</h2>

                <form>
                    <label for="emri">EMRI</label>
                    <input type="text" id="emri" placeholder="emri" required>
                    
                    <label for="shuma">SHUMA PËR TË PAGUAR (LEKË)</label>
                    <input type="number" id="shuma" placeholder="shuma" readonly style="background-color: #f0e5da; cursor: not-allowed;">
                  
                    <label for="lloji">LLOJI (KART/KESH)</label>
                    <input type="text" id="lloji" placeholder="lloji" required>
                    
                    <label for="numer">NUMRI I KARTES:</label>
                    <input type="text" id="numer" placeholder="NUMRI I KARTES" required>
                    
                    <label for="ADRESA">ADRESA</label>
                    <input type="text" id="ADRESA" placeholder="adresa">
                
                    <button type="button" id="paguaj">PAGUAJ</button>
                </form>
            </div>
        </div>

    <script>
        // --- PJESA E RE: MBUSHJA E SHUMËS AUTOMATIKISHT ---
        window.addEventListener('DOMContentLoaded', () => {
            const shumaTotale = localStorage.getItem('totalPagesa') || 0;
            document.getElementById('shuma').value = shumaTotale;
        });

        // --- PJESA EKZISTUESE E RUAJTJES SË POROSISË ---
        const paguaj = document.getElementById('paguaj');
        paguaj.addEventListener('click', () => {
            // 1. Merr të dhënat aktuale
            const klienti = JSON.parse(localStorage.getItem('teDhenatKlientit')) || {};
            const rezervimi = JSON.parse(localStorage.getItem('rezervimiIm')) || {};
            const produktet = JSON.parse(localStorage.getItem('order')) || [];
            const totali = localStorage.getItem('totalPagesa') || 0;

            // Kontroll i thjeshtë nëse ka produkte
            if(produktet.length === 0) {
                alert("Nuk mund të bëni pagesë pa pasur produkte në shportë!");
                return;
            }

            // 2. Krijo objektin e porosisë së re
            const porosiaRe = {
                id: Date.now(),
                dataPorosise: new Date().toLocaleString(),
                klienti: klienti,
                rezervimi: rezervimi,
                produktet: produktet,
                totali: totali,
                metodaPageses: document.getElementById('lloji').value // Ruajmë edhe si pagoi
            };

            // 3. Merr historinë, shto porosinë e re
            let historia = JSON.parse(localStorage.getItem('historiaPorosive')) || [];
            historia.push(porosiaRe);
            localStorage.setItem('historiaPorosive', JSON.stringify(historia));

            // 4. Pastro të dhënat e përkohshme
            localStorage.removeItem('order');
            localStorage.removeItem('totalPagesa');

            alert("Pagesa u krye me sukses!");
            window.location.href = '../html/pasmbarimitVeprimit.html'; 
        });
    </script>
    </body>
</html>